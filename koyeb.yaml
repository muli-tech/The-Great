FROM fedora:37

# Update system and install required packages
RUN dnf -y update && \
    dnf install -y \
      https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm \
      https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm && \
    dnf install -y git ffmpeg ImageMagick libwebp yarnpkg && \
    dnf clean all -y

#install yarn just incase
#RUN curl -sL https://dl.yarnpkg.com/rpm/yarn.repo | tee /etc/yum.repos.d/yarn.repo
#RUN dnf install -y yarn

#unistall nodejs
RUN dnf -y remove nodejs

# Install Node.js 20 from NodeSource
RUN curl -sL https://rpm.nodesource.com/setup_20.x | bash - && \
    dnf install -y nodejs && \
    dnf clean all -y

# Clone the repository
RUN git clone https://github.com/muli-tech/The-Great

# Set the working directory
WORKDIR /The-Great

# Install dependencies (try yarn first, then npm if yarn is not found)
RUN if command -v yarn &> /dev/null; then \
    yarn install; \
    else \
    npm install; \
    fi

# Run the application
CMD ["node", "index.js"]
